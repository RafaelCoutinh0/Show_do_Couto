<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/main_flet.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/main_flet.py" />
              <option name="originalContent" value="import os&#10;import random&#10;import traceback&#10;import flet as ft&#10;import requests&#10;import json&#10;import base64&#10;from pathlib import Path&#10;&#10;API_URL = &quot;https://showapi-production.up.railway.app&quot;&#10;&#10;&#10;def registrar_usuario(nome, matricula, email, senha):&#10;    try:&#10;        r = requests.post(f&quot;{API_URL}/register&quot;, json={&#10;            &quot;nome&quot;: nome,&#10;            &quot;matricula&quot;: matricula,&#10;            &quot;email&quot;: email,&#10;            &quot;senha&quot;: senha&#10;        }, timeout=10)&#10;        try:&#10;            data = r.json()&#10;        except Exception:&#10;            data = r.text&#10;        ok = False&#10;        if isinstance(data, dict):&#10;            # prioriza campos explícitos&#10;            if &quot;ok&quot; in data:&#10;                ok = bool(data.get(&quot;ok&quot;))&#10;            elif &quot;success&quot; in data:&#10;                ok = bool(data.get(&quot;success&quot;))&#10;            else:&#10;                # sem campo explícito, inferir por status HTTP&#10;                ok = r.status_code in (200, 201)&#10;        else:&#10;            ok = r.status_code in (200, 201)&#10;        return ok, data&#10;    except Exception as ex:&#10;        return False, str(ex)&#10;&#10;def login_usuario(matricula, senha):&#10;    try:&#10;        r = requests.post(f&quot;{API_URL}/login&quot;, json={&#10;            &quot;matricula&quot;: matricula,&#10;            &quot;senha&quot;: senha&#10;        }, timeout=10)&#10;        try:&#10;            data = r.json()&#10;        except Exception:&#10;            data = r.text&#10;        ok = False&#10;        if isinstance(data, dict):&#10;            if &quot;ok&quot; in data:&#10;                ok = bool(data.get(&quot;ok&quot;))&#10;            elif &quot;success&quot; in data:&#10;                ok = bool(data.get(&quot;success&quot;))&#10;            elif &quot;token&quot; in data and data.get(&quot;token&quot;):&#10;                # API pode retornar token em login bem sucedido&#10;                ok = True&#10;            else:&#10;                ok = r.status_code in (200, 201)&#10;        else:&#10;            ok = r.status_code in (200, 201)&#10;        return ok, data&#10;    except Exception as ex:&#10;        return False, str(ex)&#10;&#10;&#10;# Compatibilidade com cores entre versões:&#10;try:&#10;    colors = ft.colors    # versão mais nova&#10;except Exception:&#10;    try:&#10;        colors = ft.Colors  # fallback&#10;    except Exception:&#10;        colors = None  # raríssimo: fallback genérico&#10;&#10;# Import de player de áudio com fallback&#10;# flet_audio pode expor FletAudio (nomes variam entre versões)&#10;FLET_AUDIO_AVAILABLE = False&#10;try:&#10;    from flet_audio import FletAudio  # pacote flet-audio (nome comum)&#10;    FLET_AUDIO_AVAILABLE = True&#10;except Exception:&#10;    # fallback: talvez ft.Audio exista (algumas builds)&#10;    try:&#10;        _ = ft.Audio  # verifica existência&#10;        FLET_AUDIO_AVAILABLE = False  # usaremos ft.Audio como fallback ad-hoc&#10;    except Exception:&#10;        FLET_AUDIO_AVAILABLE = False&#10;&#10;# Caminhos de assets (relativos)&#10;ASSET_LOGO = &quot;logo.png&quot;&#10;ASSET_MUSICS = [&#10;    &quot;musics/music_game.mp3&quot;,&#10;    &quot;musics/pergunta1.mp3&quot;,&#10;    &quot;musics/acerto.mp3&quot;,&#10;    &quot;musics/lose.mp3&quot;,&#10;    &quot;musics/win.mp3&quot;,&#10;]&#10;&#10;&#10;class MusicaPlayer:&#10;    def __init__(self, page: ft.Page):&#10;        self.page = page&#10;        self.player = None&#10;&#10;        # Tenta criar FletAudio se disponível&#10;        try:&#10;            if 'FletAudio' in globals() and globals().get(&quot;FletAudio&quot;):&#10;                self.player = FletAudio(src=&quot;&quot;, autoplay=False)&#10;            else:&#10;                # fallback: usar ft.Audio se disponível&#10;                if hasattr(ft, &quot;Audio&quot;):&#10;                    self.player = ft.Audio(src=&quot;&quot;, autoplay=False)&#10;                else:&#10;                    self.player = None&#10;        except Exception:&#10;            self.player = None&#10;&#10;        if self.player is not None and self.player not in self.page.overlay:&#10;            try:&#10;                self.page.overlay.append(self.player)&#10;            except Exception:&#10;                pass&#10;&#10;    def tocar(self, i=0):&#10;        if not self.player:&#10;            return&#10;        try:&#10;            idx = int(i) if isinstance(i, int) else 0&#10;            idx = max(0, min(idx, len(ASSET_MUSICS) - 1))&#10;            src = ASSET_MUSICS[idx]&#10;            # garante caminho relativo (sem leading slash)&#10;            src = src.lstrip(&quot;/&quot;)&#10;            self.player.src = src&#10;            # autoplay pode não ser aceito por todas as classes; tente setar e update&#10;            try:&#10;                self.player.autoplay = True&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;        except Exception:&#10;            # não deixar quebrar a aplicação por erro de áudio&#10;            print(&quot;Erro ao tocar áudio:&quot;, traceback.format_exc())&#10;&#10;# Removido: antiga definição de TelaRegistro que herdava ft.Column (substituída por UserControl mais acima)&#10;&#10;# Removido: antiga definição de TelaLogin que herdava ft.Column (substituída por UserControl mais acima)&#10;&#10;class ShowDoMilhao:&#10;    def __init__(self, page: ft.Page, on_logout=None):&#10;        self.page = page&#10;        # callback para voltar à tela de entrada (login/registro)&#10;        self.on_logout = on_logout&#10;        try:&#10;            self.page.title = &quot;Show do Coutão&quot;&#10;            self.page.bgcolor = &quot;#002e5c&quot;&#10;        except Exception:&#10;            pass&#10;        self.musica = MusicaPlayer(page)&#10;        self.pontos = 0&#10;        self.checkpoint = 0&#10;        self.perguntas_jogo = []&#10;        self.pergunta_atual = None&#10;        self.indice = 0&#10;        self.ajuda_usada = False&#10;        self.troca_usada = False&#10;        self.ajuda_professor_usada = False&#10;        self.labels_regua = []&#10;        self.botoes = []&#10;        self.tela_inicial()&#10;&#10;    # helpers para compatibilidade de ButtonStyle entre versões&#10;    def _make_button_style(self):&#10;        # Tentamos usar text_style (nova API). Se der TypeError, tentamos textstyle.&#10;        try:&#10;            return ft.ButtonStyle(&#10;                text_style=ft.TextStyle(size=28, weight=ft.FontWeight.BOLD)&#10;            )&#10;        except TypeError:&#10;            try:&#10;                return ft.ButtonStyle(&#10;                    textstyle=ft.TextStyle(size=28, weight=ft.FontWeight.BOLD)&#10;                )&#10;            except Exception:&#10;                # fallback simples&#10;                return None&#10;        except Exception:&#10;            return None&#10;&#10;    def tela_inicial(self):&#10;        try:&#10;            self.musica.tocar(0)&#10;        except Exception:&#10;            pass&#10;        self.page.clean()&#10;        # tenta embutir a imagem como data URI para garantir exibição&#10;        def _get_logo_src():&#10;            try:&#10;                p = Path(ASSET_LOGO)&#10;                if p.exists():&#10;                    b = p.read_bytes()&#10;                    mime = &quot;image/png&quot;&#10;                    # inferir por extensão simples&#10;                    if p.suffix.lower() in [&quot;.jpg&quot;, &quot;.jpeg&quot;]:&#10;                        mime = &quot;image/jpeg&quot;&#10;                    elif p.suffix.lower() == &quot;.gif&quot;:&#10;                        mime = &quot;image/gif&quot;&#10;                    data = base64.b64encode(b).decode(&quot;ascii&quot;)&#10;                    return f&quot;data:{mime};base64,{data}&quot;&#10;            except Exception:&#10;                pass&#10;            # fallback: caminho direto (requer assets_dir configurado)&#10;            return ASSET_LOGO&#10;&#10;        # aumentar tamanho do logo&#10;        logo = ft.Image(src=_get_logo_src(), width=900, height=450, fit=ft.ImageFit.CONTAIN)&#10;        botao_style = self._make_button_style()&#10;        botao_jogar = ft.ElevatedButton(&#10;            &quot;Jogar&quot;,&#10;            on_click=self.iniciar_jogo,&#10;            bgcolor=(colors.BLUE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=300,&#10;            height=70,&#10;            style=botao_style&#10;        )&#10;        # &quot;Sair&quot; deve apenas deslogar: chamar on_logout para voltar ao login/registro&#10;        def _sair_inicial(e):&#10;            try:&#10;                if callable(getattr(self, 'on_logout', None)):&#10;                    return self.on_logout()&#10;            except Exception:&#10;                pass&#10;            # fallback: mostrar tela de entrada (login/registro)&#10;            try:&#10;                self.page.clean()&#10;            except Exception:&#10;                pass&#10;            # usar show_control para garantir compatibilidade entre versões do flet&#10;            try:&#10;                show_control(self.page, lambda: TelaEntrada(self.page, None))&#10;            except Exception:&#10;                try:&#10;                    self.page.add(TelaEntrada(self.page, None))&#10;                except Exception:&#10;                    pass&#10;&#10;        botao_sair = ft.ElevatedButton(&#10;            &quot;Sair&quot;,&#10;            on_click=_sair_inicial,&#10;            bgcolor=(colors.RED if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=300,&#10;            height=70,&#10;            style=botao_style&#10;        )&#10;        col = ft.Column([&#10;            logo,&#10;            ft.Row([botao_jogar, botao_sair], alignment=ft.MainAxisAlignment.CENTER)&#10;        ], alignment=ft.MainAxisAlignment.CENTER, horizontal_alignment=ft.CrossAxisAlignment.CENTER, spacing=24)&#10;        # envolver em Container expandido para centralizar também verticalmente&#10;        self.page.add(ft.Container(content=col, alignment=ft.alignment.center, expand=True))&#10;&#10;    def iniciar_jogo(self, e=None):&#10;        import traceback as _tb&#10;        print(&quot;[DEBUG] iniciar_jogo chamado&quot;)&#10;        try:&#10;            try:&#10;                self.musica.tocar(1)&#10;            except Exception:&#10;                pass&#10;            self.pontos = 0&#10;            # inicia jogo: limpar página e construir a interface do jogo&#10;            try:&#10;                self.page.clean()&#10;            except Exception:&#10;                pass&#10;            self.ajuda_usada = False&#10;            self.troca_usada = False&#10;            self.ajuda_professor_usada = False&#10;            # importa perguntas dinamicamente para evitar import circular no topo&#10;            try:&#10;                from perguntas import facil&#10;                self.perguntas_jogo = random.sample(facil, min(10, len(facil)))&#10;            except Exception:&#10;                self.perguntas_jogo = []&#10;            self.tela_jogo()&#10;        except Exception as exc:&#10;            tb = _tb.format_exc()&#10;            print(&quot;[ERROR] Exception em iniciar_jogo:\n&quot;, tb)&#10;            # substituir diálogo por mensagem inline&#10;            try:&#10;                _page_message(self.page, &quot;Erro ao iniciar jogo. Veja console.&quot;, (colors.RED if colors is not None else None))&#10;            except Exception:&#10;                pass&#10;            return&#10;&#10;    def tela_jogo(self):&#10;        self.page.clean()&#10;        self.labels_regua = []&#10;        regua = []&#10;        for i in range(len(self.perguntas_jogo)):&#10;            texto = f&quot;{i + 1}&quot;&#10;            icone = &quot;&quot;&#10;            cor_fundo = (colors.BLUE_900 if colors is not None else None)&#10;            cor_texto = (colors.WHITE if colors is not None else None)&#10;            bolinha = ft.Container(&#10;                content=ft.Text(texto, size=16, color=cor_texto, weight=ft.FontWeight.BOLD),&#10;                width=36,&#10;                height=36,&#10;                bgcolor=cor_fundo,&#10;                border=ft.border.all(3, (colors.YELLOW if (colors is not None) else None)),&#10;                border_radius=18,&#10;                alignment=ft.alignment.center,&#10;                margin=ft.margin.only(right=0)&#10;            )&#10;            if i + 1 in [3, 5, 8]:&#10;                icone = &quot;&quot;&#10;            elif i + 1 == 10:&#10;                icone = &quot;&quot;&#10;            item = ft.Row([&#10;                bolinha,&#10;                ft.Text(icone, size=18, color=cor_texto) if icone else ft.Text(&quot;&quot;)&#10;            ], alignment=ft.MainAxisAlignment.CENTER, spacing=2)&#10;            regua.append(item)&#10;        self.labels_regua = regua&#10;        self.label_pergunta = ft.Text(&quot;&quot;, size=18, color=(colors.YELLOW if colors is not None else None), weight=ft.FontWeight.BOLD)&#10;        self.botoes = []&#10;        for i in range(4):&#10;            botao = ft.ElevatedButton(&#10;                &quot;...&quot;,&#10;                width=500,&#10;                bgcolor=(colors.BLUE if colors is not None else None),&#10;                color=(colors.WHITE if colors is not None else None),&#10;                on_click=lambda e, i=i: self.verificar_resposta(i)&#10;            )&#10;            self.botoes.append(botao)&#10;        self.label_feedback = ft.Text(&quot;&quot;, size=16, color=(colors.WHITE if colors is not None else None))&#10;        self.label_saldo = ft.Text(f&quot;Saldo atual: R${self.pontos}&quot;, size=16, color=(colors.CYAN if colors is not None else None))&#10;        self.botao_ajuda = ft.ElevatedButton(&#10;            &quot;Rodar Dados&quot;,&#10;            bgcolor=(colors.PURPLE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=160,&#10;            on_click=self.ajuda_dado&#10;        )&#10;        self.botao_troca = ft.ElevatedButton(&#10;            &quot;Trocar Pergunta&quot;,&#10;            bgcolor=(colors.GREEN_900 if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=160,&#10;            on_click=self.trocar_pergunta&#10;        )&#10;        self.botao_professor = ft.ElevatedButton(&#10;            &quot;Ajuda dos Professores&quot;,&#10;            bgcolor=(colors.ORANGE_900 if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=160,&#10;            on_click=self.ajuda_professor&#10;        )&#10;        self.botao_desistir = ft.ElevatedButton(&quot;Desistir&quot;, on_click=self.desistir)&#10;        self.page.add(&#10;            ft.Row([&#10;                ft.Column([&#10;                    self.label_pergunta,&#10;                    *self.botoes,&#10;                    ft.Row([self.botao_ajuda, self.botao_troca, self.botao_professor]),&#10;                    self.label_feedback,&#10;                    self.label_saldo,&#10;                    ft.Row([self.botao_desistir]),  # Removido o botão &quot;Sair&quot;&#10;                ], alignment=ft.MainAxisAlignment.START),&#10;                ft.Column(regua, alignment=ft.MainAxisAlignment.START, spacing=0)&#10;            ], alignment=ft.MainAxisAlignment.CENTER)&#10;        )&#10;        self.carregar_pergunta()&#10;&#10;    # helpers de texto para dividir questão/ajuda&#10;    def dividir_pergunta(self, texto, limite=90):&#10;        if len(texto) &lt;= limite:&#10;            return texto, &quot;&quot;&#10;        idx = texto.rfind(&quot; &quot;, 0, limite)&#10;        if idx == -1:&#10;            idx = limite&#10;        return texto[:idx], texto[idx:].lstrip()&#10;&#10;    def dividir_ajuda(self, texto, limite=60):&#10;        if len(texto) &lt;= limite:&#10;            return texto&#10;        idx = texto.rfind(&quot; &quot;, 0, limite)&#10;        if idx == -1:&#10;            idx = limite&#10;        return texto[:idx] + &quot;\n&quot; + texto[idx:].lstrip()&#10;&#10;    def carregar_pergunta(self):&#10;        try:&#10;            self.musica.tocar(1)&#10;        except Exception:&#10;            pass&#10;        if self.indice &lt; len(self.perguntas_jogo):&#10;            self.pergunta_atual = self.perguntas_jogo[self.indice]&#10;            alternativas = self.pergunta_atual[&quot;alternativas&quot;][:]&#10;            correta = self.pergunta_atual[&quot;correta&quot;]&#10;            alternativas_com_indices = list(enumerate(alternativas))&#10;            random.shuffle(alternativas_com_indices)&#10;            alternativas_embaralhadas = [alt for idx, alt in alternativas_com_indices]&#10;            # novo índice da correta após embaralhar&#10;            nova_correta = [idx for idx, alt in alternativas_com_indices].index(correta)&#10;            self.pergunta_atual[&quot;alternativas_embaralhadas&quot;] = alternativas_embaralhadas&#10;            self.pergunta_atual[&quot;nova_correta&quot;] = nova_correta&#10;            texto1, texto2 = self.dividir_pergunta(self.pergunta_atual[&quot;pergunta&quot;], limite=500)&#10;            texto_completo = texto1 + (&quot;\n&quot; + texto2 if texto2 else &quot;&quot;)&#10;            pergunta_principal = ft.Container(&#10;                content=ft.Text(texto_completo, size=18, color=(colors.YELLOW if colors is not None else None), weight=ft.FontWeight.BOLD, selectable=True),&#10;                width=500,&#10;                alignment=ft.alignment.center,&#10;                padding=ft.padding.all(10),&#10;                bgcolor=None&#10;            )&#10;            self.label_pergunta = pergunta_principal&#10;            for i, alt in enumerate(alternativas_embaralhadas):&#10;                self.botoes[i].text = alt&#10;                self.botoes[i].disabled = False&#10;            self.label_feedback.value = &quot;&quot;&#10;            self.label_saldo.value = f&quot;Saldo atual: R${self.pontos}&quot;&#10;            for i, item in enumerate(self.labels_regua):&#10;                bolinha = item.controls[0]&#10;                try:&#10;                    bolinha.bgcolor = (colors.GREEN_700 if i &lt; self.indice else (colors.YELLOW_300 if i == self.indice else colors.BLUE_900))&#10;                    bolinha.border = ft.border.all(3, (colors.YELLOW if i == self.indice else colors.WHITE))&#10;                    bolinha.content.color = (colors.BLACK if i == self.indice else colors.WHITE)&#10;                except Exception:&#10;                    pass&#10;            self.page.clean()&#10;            self.page.add(&#10;                ft.Row([&#10;                    ft.Column([&#10;                        self.label_pergunta,&#10;                        *self.botoes,&#10;                        ft.Row([self.botao_ajuda, self.botao_troca, self.botao_professor]),&#10;                        self.label_feedback,&#10;                        self.label_saldo,&#10;                        ft.Row([self.botao_desistir]),&#10;                    ], alignment=ft.MainAxisAlignment.START),&#10;                    ft.Column(self.labels_regua, alignment=ft.MainAxisAlignment.START, spacing=0)&#10;                ], alignment=ft.MainAxisAlignment.CENTER)&#10;            )&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;        else:&#10;            self.vitoria()&#10;&#10;    def trocar_pergunta(self, e=None):&#10;        if self.troca_usada:&#10;            return&#10;        self.troca_usada = True&#10;        try:&#10;            self.botao_troca.visible = False&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;        try:&#10;            from perguntas import facil&#10;            perguntas_possiveis = [p for p in facil if p not in self.perguntas_jogo]&#10;        except Exception:&#10;            perguntas_possiveis = []&#10;        if perguntas_possiveis:&#10;            nova_pergunta = random.choice(perguntas_possiveis)&#10;            self.perguntas_jogo[self.indice] = nova_pergunta&#10;            self.label_feedback.value = &quot; Pergunta trocada!&quot;&#10;            try:&#10;                self.label_feedback.color = (colors.GREEN_900 if colors is not None else None)&#10;            except Exception:&#10;                pass&#10;            self.carregar_pergunta()&#10;        else:&#10;            self.label_feedback.value = &quot;Não há perguntas disponíveis para troca.&quot;&#10;            try:&#10;                self.label_feedback.color = colors.RED&#10;            except Exception:&#10;                pass&#10;        try:&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    def ajuda_dado(self, e=None):&#10;        if self.ajuda_usada:&#10;            return&#10;        self.ajuda_usada = True&#10;        try:&#10;            self.botao_ajuda.visible = False&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;        correta = self.pergunta_atual[&quot;nova_correta&quot;]&#10;        alternativas_restantes = [i for i in range(4) if i != correta and not self.botoes[i].disabled]&#10;        qtd_eliminar = min(random.randint(1, 3), len(alternativas_restantes))&#10;        eliminar = random.sample(alternativas_restantes, qtd_eliminar)&#10;        for i in eliminar:&#10;            self.botoes[i].disabled = True&#10;            self.botoes[i].text = &quot; &quot;&#10;        self.label_feedback.value = f&quot; Dado rolado: {qtd_eliminar} alternativas eliminadas.&quot;&#10;        try:&#10;            self.label_feedback.color = (colors.PURPLE if colors is not None else None)&#10;        except Exception:&#10;            pass&#10;        try:&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    def ajuda_professor(self, e=None):&#10;        if self.ajuda_professor_usada:&#10;            return&#10;        self.ajuda_professor_usada = True&#10;        try:&#10;            self.botao_professor.visible = False&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;        texto_ajuda = self.pergunta_atual.get(&quot;ajuda&quot;, &quot;‍ Os professores sugerem que você pense bem antes de responder!&quot;)&#10;        texto_ajuda = self.dividir_ajuda(texto_ajuda, limite=38)&#10;        self.label_feedback.value = f&quot;‍ Ajuda dos Professores: {texto_ajuda}&quot;&#10;        try:&#10;            self.label_feedback.color = (colors.RED if colors is not None else None)&#10;        except Exception:&#10;            pass&#10;        try:&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    def verificar_resposta(self, escolha):&#10;        for botao in self.botoes:&#10;            botao.disabled = True&#10;        correta = self.pergunta_atual[&quot;nova_correta&quot;]&#10;        if escolha == correta:&#10;            try:&#10;                self.musica.tocar(2)&#10;            except Exception:&#10;                pass&#10;            self.pontos += 1000&#10;            if (self.indice + 1) in [3, 5, 8]:&#10;                self.checkpoint = self.pontos&#10;            self.label_feedback.value = f&quot;✅ Correto! Ganhou R$1000&quot;&#10;            try:&#10;                self.label_feedback.color = (colors.GREEN if colors is not None else None)&#10;            except Exception:&#10;                pass&#10;            self.label_saldo.value = f&quot;Saldo atual: R${self.pontos}&quot;&#10;            self.indice += 1&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            self.page.run_task(self._delay_carregar_pergunta)&#10;        else:&#10;            self.page.run_task(self._delay_derrota)&#10;        try:&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    async def _delay_carregar_pergunta(self):&#10;        import asyncio&#10;        await asyncio.sleep(1.5)&#10;        self.carregar_pergunta()&#10;&#10;    async def _delay_derrota(self):&#10;        import asyncio&#10;        await asyncio.sleep(0.5)&#10;        self.derrota()&#10;&#10;    def vitoria(self):&#10;        self.page.clean()&#10;        try:&#10;            self.musica.tocar(4)&#10;        except Exception:&#10;            pass&#10;        msg = ft.Text(&#10;            f&quot; Parabéns, você ganhou!\nSaiu com R${self.pontos}&quot;,&#10;            size=24,&#10;            color=(colors.YELLOW if colors is not None else None),&#10;            weight=ft.FontWeight.BOLD,&#10;            text_align=ft.TextAlign.CENTER&#10;        )&#10;        botao_voltar = ft.ElevatedButton(&#10;            &quot;Voltar ao início&quot;,&#10;            bgcolor=(colors.BLUE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            on_click=lambda _: self.tela_inicial()&#10;        )&#10;        self.page.add(&#10;            ft.Container(&#10;                content=ft.Column([msg, botao_voltar], alignment=ft.MainAxisAlignment.CENTER, horizontal_alignment=ft.CrossAxisAlignment.CENTER),&#10;                alignment=ft.alignment.center,&#10;                expand=True&#10;            )&#10;        )&#10;&#10;    def derrota(self):&#10;        self.page.clean()&#10;        try:&#10;            self.musica.tocar(3)&#10;        except Exception:&#10;            pass&#10;        msg = ft.Text(&#10;            f&quot;❌ Você perdeu!\nSaiu com R${self.checkpoint}&quot;,&#10;            size=24,&#10;            color=(colors.RED if colors is not None else None),&#10;            weight=ft.FontWeight.BOLD,&#10;            text_align=ft.TextAlign.CENTER&#10;        )&#10;        botao_voltar = ft.ElevatedButton(&#10;            &quot;Voltar ao início&quot;,&#10;            bgcolor=(colors.BLUE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            on_click=lambda _: self.tela_inicial()&#10;        )&#10;        self.page.add(&#10;            ft.Container(&#10;                content=ft.Column([msg, botao_voltar], alignment=ft.MainAxisAlignment.CENTER, horizontal_alignment=ft.CrossAxisAlignment.CENTER),&#10;                alignment=ft.alignment.center,&#10;                expand=True&#10;            )&#10;        )&#10;&#10;    def desistir(self, e=None):&#10;        # Sem diálogos: processa desistência imediatamente&#10;        try:&#10;            self.page.dialog = None&#10;        except Exception:&#10;            pass&#10;        try:&#10;            # limpar eventuais AlertDialogs remanescentes na overlay (compat)&#10;            ov = getattr(self.page, &quot;overlay&quot;, [])&#10;            for it in list(ov):&#10;                try:&#10;                    if getattr(it, &quot;__class__&quot;, None).__name__ == &quot;AlertDialog&quot;:&#10;                        try:&#10;                            ov.remove(it)&#10;                        except Exception:&#10;                            pass&#10;                except Exception:&#10;                    pass&#10;        except Exception:&#10;            pass&#10;&#10;        # ação de desistir (mesma lógica do &quot;Sim&quot; anterior)&#10;        try:&#10;            self.page.clean()&#10;        except Exception:&#10;            pass&#10;        msg = ft.Text(&#10;            f&quot; Você desistiu!\nSaiu com R${self.pontos}&quot;,&#10;            size=24,&#10;            color=(colors.ORANGE if colors is not None else None),&#10;            weight=ft.FontWeight.BOLD,&#10;            text_align=ft.TextAlign.CENTER&#10;        )&#10;        botao_voltar = ft.ElevatedButton(&#10;            &quot;Voltar ao início&quot;,&#10;            bgcolor=(colors.BLUE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            on_click=lambda _: self.tela_inicial()&#10;        )&#10;        self.page.add(&#10;            ft.Container(&#10;                content=ft.Column([msg, botao_voltar], alignment=ft.MainAxisAlignment.CENTER, horizontal_alignment=ft.CrossAxisAlignment.CENTER),&#10;                alignment=ft.alignment.center,&#10;                expand=True&#10;            )&#10;        )&#10;&#10;# Compatibilidade: substituir UserControl por Control&#10;if not hasattr(ft, &quot;Control&quot;):&#10;    ft.Control = ft.Container  # Fallback para versões antigas&#10;&#10;# Nova função: mostra/atualiza mensagem simples na página (sem diálogos)&#10;def _page_message(page: ft.Page, message: str, color=None):&#10;    try:&#10;        if not message:&#10;            message = &quot;&quot;&#10;        txt = getattr(page, &quot;_page_message&quot;, None)&#10;        if txt is None:&#10;            txt = ft.Text(message, color=color, size=14)&#10;            page._page_message = txt&#10;            try:&#10;                # adicionar no topo; dependendo do fluxo, page.clean() pode remover isso&#10;                page.add(txt)&#10;            except Exception:&#10;                try:&#10;                    page.controls.insert(0, txt)&#10;                except Exception:&#10;                    pass&#10;        else:&#10;            txt.value = message&#10;            if color is not None:&#10;                try:&#10;                    txt.color = color&#10;                except Exception:&#10;                    pass&#10;        try:&#10;            page.update()&#10;        except Exception:&#10;            pass&#10;    except Exception as ex:&#10;        print(&quot;Erro _page_message:&quot;, ex)&#10;&#10;# Função adicionada: show_control&#10;def show_control(page: ft.Page, control_or_factory, *args, **kwargs):&#10;    &quot;&quot;&quot;&#10;    Substitui o conteúdo da página pelo controle retornado por control_or_factory.&#10;    control_or_factory pode ser:&#10;      - uma callable que retorna uma instância (UserControl ou outro), ou&#10;      - uma instância de controle.&#10;    Retorna a instância criada (ou None em erro).&#10;    &quot;&quot;&quot;&#10;    try:&#10;        # criar ou obter a instância do controle&#10;        ctrl = control_or_factory(*args, **kwargs) if callable(control_or_factory) else control_or_factory&#10;&#10;        # Se for uma instância de ft.UserControl (ou substituto), NÃO chamar build() manualmente:&#10;        # adicionar a instância e deixar o framework gerenciar o build.&#10;        try:&#10;            is_usercontrol = isinstance(ctrl, ft.UserControl)&#10;        except Exception:&#10;            # fallback: detectar pelo nome da classe&#10;            is_usercontrol = getattr(ctrl.__class__, &quot;__name__&quot;, &quot;&quot;) == &quot;UserControl&quot;&#10;&#10;        built = None&#10;        if is_usercontrol:&#10;            built = ctrl  # adicionar a instância diretamente&#10;        else:&#10;            # se tem build(), tentar usar o resultado; senão, usar a própria instância&#10;            if hasattr(ctrl, &quot;build&quot;) and callable(getattr(ctrl, &quot;build&quot;)):&#10;                try:&#10;                    built = ctrl.build() or ctrl&#10;                except Exception:&#10;                    # se build falhar, fallback para a própria instância&#10;                    built = ctrl&#10;            else:&#10;                built = ctrl&#10;&#10;        # limpar a página (tenta várias estratégias)&#10;        try:&#10;            page.clean()&#10;        except Exception:&#10;            try:&#10;                if hasattr(page, &quot;controls&quot;):&#10;                    page.controls.clear()&#10;            except Exception:&#10;                pass&#10;&#10;        # adicionar built (pode ser lista/tupla ou um único controle)&#10;        try:&#10;            if isinstance(built, (list, tuple)):&#10;                for c in built:&#10;                    page.add(c)&#10;            else:&#10;                page.add(built)&#10;        except Exception:&#10;            try:&#10;                page.controls.append(built)&#10;            except Exception:&#10;                pass&#10;&#10;        try:&#10;            page.update()&#10;        except Exception:&#10;            pass&#10;&#10;        return ctrl&#10;    except Exception as ex:&#10;        # não quebrar a aplicação; log simples&#10;        try:&#10;            print(&quot;show_control error:&quot;, ex)&#10;        except Exception:&#10;            pass&#10;        return None&#10;&#10;class TelaEntrada(ft.Control):  # Substituir UserControl por Control&#10;    def __init__(self, page, callback):&#10;        super().__init__()&#10;        self.page = page&#10;        self.callback = callback&#10;&#10;    def build(self):&#10;        # Adicionar a logo na tela inicial&#10;        def _get_logo_src():&#10;            try:&#10;                p = Path(ASSET_LOGO)&#10;                if p.exists():&#10;                    b = p.read_bytes()&#10;                    mime = &quot;image/png&quot;&#10;                    # inferir por extensão simples&#10;                    if p.suffix.lower() in [&quot;.jpg&quot;, &quot;.jpeg&quot;]:&#10;                        mime = &quot;image/jpeg&quot;&#10;                    elif p.suffix.lower() == &quot;.gif&quot;:&#10;                        mime = &quot;image/gif&quot;&#10;                    data = base64.b64encode(b).decode(&quot;ascii&quot;)&#10;                    return f&quot;data:{mime};base64,{data}&quot;&#10;            except Exception:&#10;                pass&#10;            # fallback: caminho direto (requer assets_dir configurado)&#10;            return ASSET_LOGO&#10;&#10;        logo = ft.Image(src=_get_logo_src(), width=300, height=150, fit=ft.ImageFit.CONTAIN)&#10;&#10;        btn_entrar = ft.ElevatedButton(&quot;Entrar&quot;, width=300, on_click=self.entrar)&#10;        btn_registrar = ft.ElevatedButton(&quot;Registrar&quot;, width=300, on_click=self.registrar)&#10;        btn_guest = ft.TextButton(&quot;Entrar sem conta&quot;, width=300, on_click=self.entrar_sem_conta)&#10;        col = ft.Column(&#10;            [&#10;                logo,  # Adiciona a logo no topo&#10;                ft.Text(&quot;Bem-vindo&quot;, size=28, weight=ft.FontWeight.BOLD),&#10;                btn_entrar,&#10;                btn_registrar,&#10;                btn_guest&#10;            ],&#10;            alignment=ft.MainAxisAlignment.CENTER,&#10;            horizontal_alignment=ft.CrossAxisAlignment.CENTER,&#10;            spacing=12&#10;        )&#10;        # Container expandido para centralizar verticalmente&#10;        return ft.Container(content=col, alignment=ft.alignment.center, expand=True)&#10;&#10;    def entrar(self, e):&#10;        try:&#10;            show_control(self.page, lambda: TelaLogin(self.page, self.callback))&#10;            return&#10;        except Exception:&#10;            pass&#10;        try:&#10;            self.page.clean()&#10;        except Exception:&#10;            pass&#10;        try:&#10;            show_control(self.page, lambda: TelaEntrada(self.page, self.callback))&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    def registrar(self, e):&#10;        try:&#10;            # Garantir que TelaRegistro seja exibida corretamente&#10;            show_control(self.page, lambda: TelaRegistro(self.page, self.callback))&#10;            self.page.update()  # Forçar atualização da página&#10;        except Exception as ex:&#10;            import traceback as _tb&#10;            tb = _tb.format_exc()&#10;            print(&quot;[ERROR] Erro ao abrir TelaRegistro:&quot;, tb)  # Log para depuração&#10;            try:&#10;                _page_message(self.page, &quot;Erro ao abrir Registro. Veja console.&quot;, (colors.RED if colors is not None else None))&#10;            except Exception:&#10;                pass&#10;&#10;    # Novo: entrar como convidado (sem conta)&#10;    def entrar_sem_conta(self, e):&#10;        try:&#10;            # inicia o jogo diretamente como &quot;convidado&quot;&#10;            ShowDoMilhao(self.page, on_logout=lambda: show_control(self.page, lambda: TelaEntrada(self.page, self.callback)))&#10;            return&#10;        except Exception as ex:&#10;            try:&#10;                _page_message(self.page, &quot;Erro ao entrar como convidado&quot;, str(ex))&#10;            except Exception:&#10;                pass&#10;        # fallback: voltar à tela de entrada&#10;        try:&#10;            show_control(self.page, lambda: TelaEntrada(self.page, self.callback))&#10;        except Exception:&#10;            pass&#10;&#10;# Novas classes adicionadas: TelaLogin e TelaRegistro&#10;class TelaLogin(ft.Control):  # Substituir UserControl por Control&#10;    def __init__(self, page, callback):&#10;        super().__init__()&#10;        self.page = page&#10;        self.callback = callback&#10;        self.matricula = ft.TextField(label=&quot;Matrícula&quot;, width=320)&#10;        self.senha = ft.TextField(label=&quot;Senha&quot;, password=True, can_reveal_password=True, width=320)&#10;        self.msg = ft.Text(&quot;&quot;, size=14)  # área de mensagem inline&#10;&#10;    def build(self):&#10;        btn_ok = ft.ElevatedButton(&quot;Entrar&quot;, width=320, on_click=self.on_entrar)&#10;        btn_voltar = ft.TextButton(&quot;Voltar&quot;, on_click=self.on_voltar)&#10;        col = ft.Column(&#10;            [&#10;                ft.Text(&quot;Login&quot;, size=24, weight=ft.FontWeight.BOLD),&#10;                self.matricula,&#10;                self.senha,&#10;                btn_ok,&#10;                btn_voltar,&#10;                self.msg  # mostrar mensagens aqui&#10;            ],&#10;            alignment=ft.MainAxisAlignment.CENTER,&#10;            horizontal_alignment=ft.CrossAxisAlignment.CENTER,&#10;            spacing=12&#10;        )&#10;        return ft.Container(content=col, alignment=ft.alignment.center, expand=True)&#10;&#10;    def on_entrar(self, e):&#10;        matricula = (self.matricula.value or &quot;&quot;).strip()&#10;        senha = (self.senha.value or &quot;&quot;).strip()&#10;        if not matricula or not senha:&#10;            self.msg.value = &quot;Informe matrícula e senha.&quot;&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            return&#10;        try:&#10;            ok, resp = login_usuario(matricula, senha)&#10;        except Exception as ex:&#10;            self.msg.value = str(ex)&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            return&#10;        if ok:&#10;            try:&#10;                ShowDoMilhao(self.page, on_logout=lambda: show_control(self.page, lambda: TelaEntrada(self.page, self.callback)))&#10;                return&#10;            except Exception as ex:&#10;                self.msg.value = &quot;Erro ao iniciar jogo.&quot;&#10;                self.msg.color = (colors.RED if colors is not None else None)&#10;                try:&#10;                    self.page.update()&#10;                except Exception:&#10;                    pass&#10;        else:&#10;            # Mostrar mensagem de erro em vermelho&#10;            self.msg.value = &quot;Senha ou Matricula Incorreta!&quot;&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.senha.value = &quot;&quot;&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;&#10;    def on_voltar(self, e):&#10;        try:&#10;            show_control(self.page, lambda: TelaEntrada(self.page, self.callback))&#10;        except Exception:&#10;            try:&#10;                self.page.clean()&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.add(TelaEntrada(self.page, self.callback))&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;&#10;&#10;class TelaRegistro(ft.Control):  # Substituir UserControl por Control&#10;    def __init__(self, page, callback):&#10;        super().__init__()&#10;        self.page = page&#10;        self.callback = callback&#10;        self.nome = ft.TextField(label=&quot;Nome&quot;, width=320)&#10;        self.matricula = ft.TextField(label=&quot;Matrícula&quot;, width=320)&#10;        self.email = ft.TextField(label=&quot;Email&quot;, width=320)&#10;        self.senha = ft.TextField(label=&quot;Senha&quot;, password=True, can_reveal_password=True, width=320)&#10;        self.msg = ft.Text(&quot;&quot;, size=14)  # área de mensagem inline&#10;&#10;    def build(self):&#10;        btn_reg = ft.ElevatedButton(&quot;Registrar&quot;, width=320, on_click=self.on_registrar)&#10;        btn_voltar = ft.TextButton(&quot;Voltar&quot;, on_click=self.on_voltar)&#10;        col = ft.Column(&#10;            [&#10;                ft.Text(&quot;Registrar&quot;, size=24, weight=ft.FontWeight.BOLD),&#10;                self.nome,&#10;                self.matricula,&#10;                self.email,&#10;                self.senha,&#10;                btn_reg,&#10;                btn_voltar,&#10;                self.msg  # mostrar mensagens aqui&#10;            ],&#10;            alignment=ft.MainAxisAlignment.CENTER,&#10;            horizontal_alignment=ft.CrossAxisAlignment.CENTER,&#10;            spacing=10&#10;        )&#10;        return ft.Container(content=col, alignment=ft.alignment.center, expand=True)&#10;&#10;    def on_registrar(self, e):&#10;        nome = (self.nome.value or &quot;&quot;).strip()&#10;        matricula = (self.matricula.value or &quot;&quot;).strip()&#10;        email = (self.email.value or &quot;&quot;).strip()&#10;        senha = (self.senha.value or &quot;&quot;).strip()&#10;        try:&#10;            ok, resp = registrar_usuario(nome, matricula, email, senha)&#10;        except Exception as ex:&#10;            self.msg.value = str(ex)&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            return&#10;        if ok:&#10;            # sucesso: mostrar mensagem verde e redirecionar para login após delay curto&#10;            self.msg.value = &quot;Usuário registrado com sucesso. Redirecionando para Login...&quot;&#10;            self.msg.color = (colors.GREEN if colors is not None else None)&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            # agendar redirecionamento breve&#10;            def _delayed():&#10;                import time&#10;                try:&#10;                    time.sleep(1.2)&#10;                except Exception:&#10;                    pass&#10;                try:&#10;                    show_control(self.page, lambda: TelaLogin(self.page, self.callback))&#10;                    self.page.update()  # Forçar atualização após redirecionamento&#10;                except Exception as ex:&#10;                    print(&quot;[ERROR] Erro ao redirecionar para TelaLogin:&quot;, ex)&#10;            try:&#10;                # executar em thread leve sem bloquear UI&#10;                import threading&#10;                threading.Thread(target=_delayed, daemon=True).start()&#10;            except Exception:&#10;                try:&#10;                    show_control(self.page, lambda: TelaLogin(self.page, self.callback))&#10;                    self.page.update()&#10;                except Exception:&#10;                    pass&#10;        else:&#10;            msg = str(resp)&#10;            self.msg.value = msg&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.senha.value = &quot;&quot;&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;&#10;    def on_voltar(self, e):&#10;        try:&#10;            # Voltar para a tela de entrada&#10;            show_control(self.page, lambda: TelaEntrada(self.page, self.callback))&#10;        except Exception as ex:&#10;            print(&quot;[ERROR] Erro ao voltar para TelaEntrada:&quot;, ex)&#10;            try:&#10;                self.page.clean()&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.add(TelaEntrada(self.page, self.callback))&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;&#10;# Removidas funções de AlertDialog; agora usar _page_message ou mensagens nas telas.&#10;&#10;def main(page: ft.Page):&#10;    # define cor de fundo já na entrada para evitar tela cinza em formulários&#10;    try:&#10;        page.bgcolor = &quot;#002e5c&quot;&#10;    except Exception:&#10;        pass&#10;&#10;    def iniciar_jogo():&#10;        try:&#10;            page.clean()&#10;        except Exception:&#10;            pass&#10;&#10;        # função para retornar à tela de entrada (login/registro)&#10;        def show_entry():&#10;            try:&#10;                page.clean()&#10;            except Exception:&#10;                pass&#10;            try:&#10;                show_control(page, lambda: TelaEntrada(page, iniciar_jogo))&#10;            except Exception:&#10;                try:&#10;                    page.add(TelaEntrada(page, iniciar_jogo))&#10;                except Exception:&#10;                    pass&#10;&#10;        try:&#10;            # envolver toda inicialização do jogo em try/except para capturar erros&#10;            # aqui simplesmente mostramos a tela de entrada (registro/login)&#10;            show_entry()&#10;            try:&#10;                page.update()&#10;            except Exception:&#10;                pass&#10;        except Exception:&#10;            try:&#10;                import traceback as _tb&#10;                tb = _tb.format_exc()&#10;            except Exception:&#10;                tb = &quot;Erro desconhecido&quot;&#10;            try:&#10;                _page_message(page, &quot;Erro ao iniciar interface&quot;, tb)&#10;            except Exception:&#10;                pass&#10;&#10;    # inicialização padrão quando a app é aberta&#10;    try:&#10;        # mostra a tela de entrada e passa o callback iniciar_jogo (usar show_control para compat)&#10;        show_control(page, lambda: TelaEntrada(page, iniciar_jogo))&#10;        try:&#10;            page.update()&#10;        except Exception:&#10;            pass&#10;    except Exception:&#10;        try:&#10;            import traceback as _tb&#10;            tb = _tb.format_exc()&#10;        except Exception:&#10;            tb = &quot;Erro desconhecido&quot;&#10;        try:&#10;            _page_message(page, &quot;Erro na inicialização. Veja console.&quot;, (colors.RED if colors is not None else None))&#10;        except Exception:&#10;            pass&#10;&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    # Usa a porta do Railway se existir&#10;    port = os.environ.get(&quot;PORT&quot;)&#10;&#10;    if port:&#10;        #  Modo WEB (Railway ou celular)&#10;        ft.app(&#10;            target=main,&#10;            view=ft.WEB_BROWSER,&#10;            port=int(port),&#10;            host=&quot;0.0.0.0&quot;,&#10;            assets_dir=&quot;.&quot;    # ✅ preciso para logo e audio funcionarem&#10;        )&#10;    else:&#10;        #  Modo APP (rodando no PC local)&#10;        ft.app(&#10;            target=main,&#10;            view=ft.AppView,  # ✅ importante para gerar APK e rodar localmente&#10;            assets_dir=&quot;.&quot;    # ✅ necessário para carregar logo.png&#10;        )&#10;" />
              <option name="updatedContent" value="import os&#10;import random&#10;import traceback&#10;import flet as ft&#10;import requests&#10;import json&#10;import base64&#10;from pathlib import Path&#10;&#10;API_URL = &quot;https://showapi-production.up.railway.app&quot;&#10;&#10;&#10;def registrar_usuario(nome, matricula, email, senha):&#10;    try:&#10;        r = requests.post(f&quot;{API_URL}/register&quot;, json={&#10;            &quot;nome&quot;: nome,&#10;            &quot;matricula&quot;: matricula,&#10;            &quot;email&quot;: email,&#10;            &quot;senha&quot;: senha&#10;        }, timeout=10)&#10;        try:&#10;            data = r.json()&#10;        except Exception:&#10;            data = r.text&#10;        ok = False&#10;        if isinstance(data, dict):&#10;            # prioriza campos explícitos&#10;            if &quot;ok&quot; in data:&#10;                ok = bool(data.get(&quot;ok&quot;))&#10;            elif &quot;success&quot; in data:&#10;                ok = bool(data.get(&quot;success&quot;))&#10;            else:&#10;                # sem campo explícito, inferir por status HTTP&#10;                ok = r.status_code in (200, 201)&#10;        else:&#10;            ok = r.status_code in (200, 201)&#10;        return ok, data&#10;    except Exception as ex:&#10;        return False, str(ex)&#10;&#10;def login_usuario(matricula, senha):&#10;    try:&#10;        r = requests.post(f&quot;{API_URL}/login&quot;, json={&#10;            &quot;matricula&quot;: matricula,&#10;            &quot;senha&quot;: senha&#10;        }, timeout=10)&#10;        try:&#10;            data = r.json()&#10;        except Exception:&#10;            data = r.text&#10;        ok = False&#10;        if isinstance(data, dict):&#10;            if &quot;ok&quot; in data:&#10;                ok = bool(data.get(&quot;ok&quot;))&#10;            elif &quot;success&quot; in data:&#10;                ok = bool(data.get(&quot;success&quot;))&#10;            elif &quot;token&quot; in data and data.get(&quot;token&quot;):&#10;                # API pode retornar token em login bem sucedido&#10;                ok = True&#10;            else:&#10;                ok = r.status_code in (200, 201)&#10;        else:&#10;            ok = r.status_code in (200, 201)&#10;        return ok, data&#10;    except Exception as ex:&#10;        return False, str(ex)&#10;&#10;&#10;# Compatibilidade com cores entre versões:&#10;try:&#10;    colors = ft.colors    # versão mais nova&#10;except Exception:&#10;    try:&#10;        colors = ft.Colors  # fallback&#10;    except Exception:&#10;        colors = None  # raríssimo: fallback genérico&#10;&#10;# Import de player de áudio com fallback&#10;# flet_audio pode expor FletAudio (nomes variam entre versões)&#10;FLET_AUDIO_AVAILABLE = False&#10;try:&#10;    from flet_audio import FletAudio  # pacote flet-audio (nome comum)&#10;    FLET_AUDIO_AVAILABLE = True&#10;except Exception:&#10;    # fallback: talvez ft.Audio exista (algumas builds)&#10;    try:&#10;        _ = ft.Audio  # verifica existência&#10;        FLET_AUDIO_AVAILABLE = False  # usaremos ft.Audio como fallback ad-hoc&#10;    except Exception:&#10;        FLET_AUDIO_AVAILABLE = False&#10;&#10;# Caminhos de assets (relativos)&#10;ASSET_LOGO = &quot;logo.png&quot;&#10;ASSET_MUSICS = [&#10;    &quot;musics/music_game.mp3&quot;,&#10;    &quot;musics/pergunta1.mp3&quot;,&#10;    &quot;musics/acerto.mp3&quot;,&#10;    &quot;musics/lose.mp3&quot;,&#10;    &quot;musics/win.mp3&quot;,&#10;]&#10;&#10;&#10;class MusicaPlayer:&#10;    def __init__(self, page: ft.Page):&#10;        self.page = page&#10;        self.player = None&#10;&#10;        # Tenta criar FletAudio se disponível&#10;        try:&#10;            if 'FletAudio' in globals() and globals().get(&quot;FletAudio&quot;):&#10;                self.player = FletAudio(src=&quot;&quot;, autoplay=False)&#10;            else:&#10;                # fallback: usar ft.Audio se disponível&#10;                if hasattr(ft, &quot;Audio&quot;):&#10;                    self.player = ft.Audio(src=&quot;&quot;, autoplay=False)&#10;                else:&#10;                    self.player = None&#10;        except Exception:&#10;            self.player = None&#10;&#10;        if self.player is not None and self.player not in self.page.overlay:&#10;            try:&#10;                self.page.overlay.append(self.player)&#10;            except Exception:&#10;                pass&#10;&#10;    def tocar(self, i=0):&#10;        if not self.player:&#10;            return&#10;        try:&#10;            idx = int(i) if isinstance(i, int) else 0&#10;            idx = max(0, min(idx, len(ASSET_MUSICS) - 1))&#10;            src = ASSET_MUSICS[idx]&#10;            # garante caminho relativo (sem leading slash)&#10;            src = src.lstrip(&quot;/&quot;)&#10;            self.player.src = src&#10;            # autoplay pode não ser aceito por todas as classes; tente setar e update&#10;            try:&#10;                self.player.autoplay = True&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;        except Exception:&#10;            # não deixar quebrar a aplicação por erro de áudio&#10;            print(&quot;Erro ao tocar áudio:&quot;, traceback.format_exc())&#10;&#10;# Removido: antiga definição de TelaRegistro que herdava ft.Column (substituída por UserControl mais acima)&#10;&#10;# Removido: antiga definição de TelaLogin que herdava ft.Column (substituída por UserControl mais acima)&#10;&#10;class ShowDoMilhao:&#10;    def __init__(self, page: ft.Page, on_logout=None):&#10;        self.page = page&#10;        # callback para voltar à tela de entrada (login/registro)&#10;        self.on_logout = on_logout&#10;        try:&#10;            self.page.title = &quot;Show do Coutão&quot;&#10;            self.page.bgcolor = &quot;#002e5c&quot;&#10;        except Exception:&#10;            pass&#10;        self.musica = MusicaPlayer(page)&#10;        self.pontos = 0&#10;        self.checkpoint = 0&#10;        self.perguntas_jogo = []&#10;        self.pergunta_atual = None&#10;        self.indice = 0&#10;        self.ajuda_usada = False&#10;        self.troca_usada = False&#10;        self.ajuda_professor_usada = False&#10;        self.labels_regua = []&#10;        self.botoes = []&#10;        self.tela_inicial()&#10;&#10;    # helpers para compatibilidade de ButtonStyle entre versões&#10;    def _make_button_style(self):&#10;        # Tentamos usar text_style (nova API). Se der TypeError, tentamos textstyle.&#10;        try:&#10;            return ft.ButtonStyle(&#10;                text_style=ft.TextStyle(size=28, weight=ft.FontWeight.BOLD)&#10;            )&#10;        except TypeError:&#10;            try:&#10;                return ft.ButtonStyle(&#10;                    textstyle=ft.TextStyle(size=28, weight=ft.FontWeight.BOLD)&#10;                )&#10;            except Exception:&#10;                # fallback simples&#10;                return None&#10;        except Exception:&#10;            return None&#10;&#10;    def tela_inicial(self):&#10;        try:&#10;            self.musica.tocar(0)&#10;        except Exception:&#10;            pass&#10;        self.page.clean()&#10;        # tenta embutir a imagem como data URI para garantir exibição&#10;        def _get_logo_src():&#10;            try:&#10;                p = Path(ASSET_LOGO)&#10;                if p.exists():&#10;                    b = p.read_bytes()&#10;                    mime = &quot;image/png&quot;&#10;                    # inferir por extensão simples&#10;                    if p.suffix.lower() in [&quot;.jpg&quot;, &quot;.jpeg&quot;]:&#10;                        mime = &quot;image/jpeg&quot;&#10;                    elif p.suffix.lower() == &quot;.gif&quot;:&#10;                        mime = &quot;image/gif&quot;&#10;                    data = base64.b64encode(b).decode(&quot;ascii&quot;)&#10;                    return f&quot;data:{mime};base64,{data}&quot;&#10;            except Exception:&#10;                pass&#10;            # fallback: caminho direto (requer assets_dir configurado)&#10;            return ASSET_LOGO&#10;&#10;        # aumentar tamanho do logo&#10;        logo = ft.Image(src=_get_logo_src(), width=900, height=450, fit=ft.ImageFit.CONTAIN)&#10;        botao_style = self._make_button_style()&#10;        botao_jogar = ft.ElevatedButton(&#10;            &quot;Jogar&quot;,&#10;            on_click=self.iniciar_jogo,&#10;            bgcolor=(colors.BLUE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=300,&#10;            height=70,&#10;            style=botao_style&#10;        )&#10;        # &quot;Sair&quot; deve apenas deslogar: chamar on_logout para voltar ao login/registro&#10;        def _sair_inicial(e):&#10;            try:&#10;                if callable(getattr(self, 'on_logout', None)):&#10;                    return self.on_logout()&#10;            except Exception:&#10;                pass&#10;            # fallback: mostrar tela de entrada (login/registro)&#10;            try:&#10;                self.page.clean()&#10;            except Exception:&#10;                pass&#10;            # usar show_control para garantir compatibilidade entre versões do flet&#10;            try:&#10;                show_control(self.page, lambda: TelaEntrada(self.page, None))&#10;            except Exception:&#10;                try:&#10;                    self.page.add(TelaEntrada(self.page, None))&#10;                except Exception:&#10;                    pass&#10;&#10;        botao_sair = ft.ElevatedButton(&#10;            &quot;Sair&quot;,&#10;            on_click=_sair_inicial,&#10;            bgcolor=(colors.RED if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=300,&#10;            height=70,&#10;            style=botao_style&#10;        )&#10;        col = ft.Column([&#10;            logo,&#10;            ft.Row([botao_jogar, botao_sair], alignment=ft.MainAxisAlignment.CENTER)&#10;        ], alignment=ft.MainAxisAlignment.CENTER, horizontal_alignment=ft.CrossAxisAlignment.CENTER, spacing=24)&#10;        # envolver em Container expandido para centralizar também verticalmente&#10;        self.page.add(ft.Container(content=col, alignment=ft.alignment.center, expand=True))&#10;&#10;    def iniciar_jogo(self, e=None):&#10;        import traceback as _tb&#10;        print(&quot;[DEBUG] iniciar_jogo chamado&quot;)&#10;        try:&#10;            try:&#10;                self.musica.tocar(1)&#10;            except Exception:&#10;                pass&#10;            self.pontos = 0&#10;            # inicia jogo: limpar página e construir a interface do jogo&#10;            try:&#10;                self.page.clean()&#10;            except Exception:&#10;                pass&#10;            self.ajuda_usada = False&#10;            self.troca_usada = False&#10;            self.ajuda_professor_usada = False&#10;            # importa perguntas dinamicamente para evitar import circular no topo&#10;            try:&#10;                from perguntas import facil&#10;                self.perguntas_jogo = random.sample(facil, min(10, len(facil)))&#10;            except Exception:&#10;                self.perguntas_jogo = []&#10;            self.tela_jogo()&#10;        except Exception as exc:&#10;            tb = _tb.format_exc()&#10;            print(&quot;[ERROR] Exception em iniciar_jogo:\n&quot;, tb)&#10;            # substituir diálogo por mensagem inline&#10;            try:&#10;                _page_message(self.page, &quot;Erro ao iniciar jogo. Veja console.&quot;, (colors.RED if colors is not None else None))&#10;            except Exception:&#10;                pass&#10;            return&#10;&#10;    def tela_jogo(self):&#10;        self.page.clean()&#10;        self.labels_regua = []&#10;        regua = []&#10;        for i in range(len(self.perguntas_jogo)):&#10;            texto = f&quot;{i + 1}&quot;&#10;            icone = &quot;&quot;&#10;            cor_fundo = (colors.BLUE_900 if colors is not None else None)&#10;            cor_texto = (colors.WHITE if colors is not None else None)&#10;            bolinha = ft.Container(&#10;                content=ft.Text(texto, size=16, color=cor_texto, weight=ft.FontWeight.BOLD),&#10;                width=36,&#10;                height=36,&#10;                bgcolor=cor_fundo,&#10;                border=ft.border.all(3, (colors.YELLOW if (colors is not None) else None)),&#10;                border_radius=18,&#10;                alignment=ft.alignment.center,&#10;                margin=ft.margin.only(right=0)&#10;            )&#10;            if i + 1 in [3, 5, 8]:&#10;                icone = &quot;&quot;&#10;            elif i + 1 == 10:&#10;                icone = &quot;&quot;&#10;            item = ft.Row([&#10;                bolinha,&#10;                ft.Text(icone, size=18, color=cor_texto) if icone else ft.Text(&quot;&quot;)&#10;            ], alignment=ft.MainAxisAlignment.CENTER, spacing=2)&#10;            regua.append(item)&#10;        self.labels_regua = regua&#10;        self.label_pergunta = ft.Text(&quot;&quot;, size=18, color=(colors.YELLOW if colors is not None else None), weight=ft.FontWeight.BOLD)&#10;        self.botoes = []&#10;        for i in range(4):&#10;            botao = ft.ElevatedButton(&#10;                &quot;...&quot;,&#10;                width=500,&#10;                bgcolor=(colors.BLUE if colors is not None else None),&#10;                color=(colors.WHITE if colors is not None else None),&#10;                on_click=lambda e, i=i: self.verificar_resposta(i)&#10;            )&#10;            self.botoes.append(botao)&#10;        self.label_feedback = ft.Text(&quot;&quot;, size=16, color=(colors.WHITE if colors is not None else None))&#10;        self.label_saldo = ft.Text(f&quot;Saldo atual: R${self.pontos}&quot;, size=16, color=(colors.CYAN if colors is not None else None))&#10;        self.botao_ajuda = ft.ElevatedButton(&#10;            &quot;Rodar Dados&quot;,&#10;            bgcolor=(colors.PURPLE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=160,&#10;            on_click=self.ajuda_dado&#10;        )&#10;        self.botao_troca = ft.ElevatedButton(&#10;            &quot;Trocar Pergunta&quot;,&#10;            bgcolor=(colors.GREEN_900 if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=160,&#10;            on_click=self.trocar_pergunta&#10;        )&#10;        self.botao_professor = ft.ElevatedButton(&#10;            &quot;Ajuda dos Professores&quot;,&#10;            bgcolor=(colors.ORANGE_900 if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            width=160,&#10;            on_click=self.ajuda_professor&#10;        )&#10;        self.botao_desistir = ft.ElevatedButton(&quot;Desistir&quot;, on_click=self.desistir)&#10;        self.page.add(&#10;            ft.Row([&#10;                ft.Column([&#10;                    self.label_pergunta,&#10;                    *self.botoes,&#10;                    ft.Row([self.botao_ajuda, self.botao_troca, self.botao_professor]),&#10;                    self.label_feedback,&#10;                    self.label_saldo,&#10;                    ft.Row([self.botao_desistir]),  # Removido o botão &quot;Sair&quot;&#10;                ], alignment=ft.MainAxisAlignment.START),&#10;                ft.Column(regua, alignment=ft.MainAxisAlignment.START, spacing=0)&#10;            ], alignment=ft.MainAxisAlignment.CENTER)&#10;        )&#10;        self.carregar_pergunta()&#10;&#10;    # helpers de texto para dividir questão/ajuda&#10;    def dividir_pergunta(self, texto, limite=90):&#10;        if len(texto) &lt;= limite:&#10;            return texto, &quot;&quot;&#10;        idx = texto.rfind(&quot; &quot;, 0, limite)&#10;        if idx == -1:&#10;            idx = limite&#10;        return texto[:idx], texto[idx:].lstrip()&#10;&#10;    def dividir_ajuda(self, texto, limite=60):&#10;        if len(texto) &lt;= limite:&#10;            return texto&#10;        idx = texto.rfind(&quot; &quot;, 0, limite)&#10;        if idx == -1:&#10;            idx = limite&#10;        return texto[:idx] + &quot;\n&quot; + texto[idx:].lstrip()&#10;&#10;    def carregar_pergunta(self):&#10;        try:&#10;            self.musica.tocar(1)&#10;        except Exception:&#10;            pass&#10;        if self.indice &lt; len(self.perguntas_jogo):&#10;            self.pergunta_atual = self.perguntas_jogo[self.indice]&#10;            alternativas = self.pergunta_atual[&quot;alternativas&quot;][:]&#10;            correta = self.pergunta_atual[&quot;correta&quot;]&#10;            alternativas_com_indices = list(enumerate(alternativas))&#10;            random.shuffle(alternativas_com_indices)&#10;            alternativas_embaralhadas = [alt for idx, alt in alternativas_com_indices]&#10;            # novo índice da correta após embaralhar&#10;            nova_correta = [idx for idx, alt in alternativas_com_indices].index(correta)&#10;            self.pergunta_atual[&quot;alternativas_embaralhadas&quot;] = alternativas_embaralhadas&#10;            self.pergunta_atual[&quot;nova_correta&quot;] = nova_correta&#10;            texto1, texto2 = self.dividir_pergunta(self.pergunta_atual[&quot;pergunta&quot;], limite=500)&#10;            texto_completo = texto1 + (&quot;\n&quot; + texto2 if texto2 else &quot;&quot;)&#10;            pergunta_principal = ft.Container(&#10;                content=ft.Text(texto_completo, size=18, color=(colors.YELLOW if colors is not None else None), weight=ft.FontWeight.BOLD, selectable=True),&#10;                width=500,&#10;                alignment=ft.alignment.center,&#10;                padding=ft.padding.all(10),&#10;                bgcolor=None&#10;            )&#10;            self.label_pergunta = pergunta_principal&#10;            for i, alt in enumerate(alternativas_embaralhadas):&#10;                self.botoes[i].text = alt&#10;                self.botoes[i].disabled = False&#10;            self.label_feedback.value = &quot;&quot;&#10;            self.label_saldo.value = f&quot;Saldo atual: R${self.pontos}&quot;&#10;            for i, item in enumerate(self.labels_regua):&#10;                bolinha = item.controls[0]&#10;                try:&#10;                    bolinha.bgcolor = (colors.GREEN_700 if i &lt; self.indice else (colors.YELLOW_300 if i == self.indice else colors.BLUE_900))&#10;                    bolinha.border = ft.border.all(3, (colors.YELLOW if i == self.indice else colors.WHITE))&#10;                    bolinha.content.color = (colors.BLACK if i == self.indice else colors.WHITE)&#10;                except Exception:&#10;                    pass&#10;            self.page.clean()&#10;            self.page.add(&#10;                ft.Row([&#10;                    ft.Column([&#10;                        self.label_pergunta,&#10;                        *self.botoes,&#10;                        ft.Row([self.botao_ajuda, self.botao_troca, self.botao_professor]),&#10;                        self.label_feedback,&#10;                        self.label_saldo,&#10;                        ft.Row([self.botao_desistir]),&#10;                    ], alignment=ft.MainAxisAlignment.START),&#10;                    ft.Column(self.labels_regua, alignment=ft.MainAxisAlignment.START, spacing=0)&#10;                ], alignment=ft.MainAxisAlignment.CENTER)&#10;            )&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;        else:&#10;            self.vitoria()&#10;&#10;    def trocar_pergunta(self, e=None):&#10;        if self.troca_usada:&#10;            return&#10;        self.troca_usada = True&#10;        try:&#10;            self.botao_troca.visible = False&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;        try:&#10;            from perguntas import facil&#10;            perguntas_possiveis = [p for p in facil if p not in self.perguntas_jogo]&#10;        except Exception:&#10;            perguntas_possiveis = []&#10;        if perguntas_possiveis:&#10;            nova_pergunta = random.choice(perguntas_possiveis)&#10;            self.perguntas_jogo[self.indice] = nova_pergunta&#10;            self.label_feedback.value = &quot; Pergunta trocada!&quot;&#10;            try:&#10;                self.label_feedback.color = (colors.GREEN_900 if colors is not None else None)&#10;            except Exception:&#10;                pass&#10;            self.carregar_pergunta()&#10;        else:&#10;            self.label_feedback.value = &quot;Não há perguntas disponíveis para troca.&quot;&#10;            try:&#10;                self.label_feedback.color = colors.RED&#10;            except Exception:&#10;                pass&#10;        try:&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    def ajuda_dado(self, e=None):&#10;        if self.ajuda_usada:&#10;            return&#10;        self.ajuda_usada = True&#10;        try:&#10;            self.botao_ajuda.visible = False&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;        correta = self.pergunta_atual[&quot;nova_correta&quot;]&#10;        alternativas_restantes = [i for i in range(4) if i != correta and not self.botoes[i].disabled]&#10;        qtd_eliminar = min(random.randint(1, 3), len(alternativas_restantes))&#10;        eliminar = random.sample(alternativas_restantes, qtd_eliminar)&#10;        for i in eliminar:&#10;            self.botoes[i].disabled = True&#10;            self.botoes[i].text = &quot; &quot;&#10;        self.label_feedback.value = f&quot; Dado rolado: {qtd_eliminar} alternativas eliminadas.&quot;&#10;        try:&#10;            self.label_feedback.color = (colors.PURPLE if colors is not None else None)&#10;        except Exception:&#10;            pass&#10;        try:&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    def ajuda_professor(self, e=None):&#10;        if self.ajuda_professor_usada:&#10;            return&#10;        self.ajuda_professor_usada = True&#10;        try:&#10;            self.botao_professor.visible = False&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;        texto_ajuda = self.pergunta_atual.get(&quot;ajuda&quot;, &quot;‍ Os professores sugerem que você pense bem antes de responder!&quot;)&#10;        texto_ajuda = self.dividir_ajuda(texto_ajuda, limite=38)&#10;        self.label_feedback.value = f&quot;‍ Ajuda dos Professores: {texto_ajuda}&quot;&#10;        try:&#10;            self.label_feedback.color = (colors.RED if colors is not None else None)&#10;        except Exception:&#10;            pass&#10;        try:&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    def verificar_resposta(self, escolha):&#10;        for botao in self.botoes:&#10;            botao.disabled = True&#10;        correta = self.pergunta_atual[&quot;nova_correta&quot;]&#10;        if escolha == correta:&#10;            try:&#10;                self.musica.tocar(2)&#10;            except Exception:&#10;                pass&#10;            self.pontos += 1000&#10;            if (self.indice + 1) in [3, 5, 8]:&#10;                self.checkpoint = self.pontos&#10;            self.label_feedback.value = f&quot;✅ Correto! Ganhou R$1000&quot;&#10;            try:&#10;                self.label_feedback.color = (colors.GREEN if colors is not None else None)&#10;            except Exception:&#10;                pass&#10;            self.label_saldo.value = f&quot;Saldo atual: R${self.pontos}&quot;&#10;            self.indice += 1&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            self.page.run_task(self._delay_carregar_pergunta)&#10;        else:&#10;            self.page.run_task(self._delay_derrota)&#10;        try:&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    async def _delay_carregar_pergunta(self):&#10;        import asyncio&#10;        await asyncio.sleep(1.5)&#10;        self.carregar_pergunta()&#10;&#10;    async def _delay_derrota(self):&#10;        import asyncio&#10;        await asyncio.sleep(0.5)&#10;        self.derrota()&#10;&#10;    def vitoria(self):&#10;        self.page.clean()&#10;        try:&#10;            self.musica.tocar(4)&#10;        except Exception:&#10;            pass&#10;        msg = ft.Text(&#10;            f&quot; Parabéns, você ganhou!\nSaiu com R${self.pontos}&quot;,&#10;            size=24,&#10;            color=(colors.YELLOW if colors is not None else None),&#10;            weight=ft.FontWeight.BOLD,&#10;            text_align=ft.TextAlign.CENTER&#10;        )&#10;        botao_voltar = ft.ElevatedButton(&#10;            &quot;Voltar ao início&quot;,&#10;            bgcolor=(colors.BLUE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            on_click=lambda _: self.tela_inicial()&#10;        )&#10;        self.page.add(&#10;            ft.Container(&#10;                content=ft.Column([msg, botao_voltar], alignment=ft.MainAxisAlignment.CENTER, horizontal_alignment=ft.CrossAxisAlignment.CENTER),&#10;                alignment=ft.alignment.center,&#10;                expand=True&#10;            )&#10;        )&#10;&#10;    def derrota(self):&#10;        self.page.clean()&#10;        try:&#10;            self.musica.tocar(3)&#10;        except Exception:&#10;            pass&#10;        msg = ft.Text(&#10;            f&quot;❌ Você perdeu!\nSaiu com R${self.checkpoint}&quot;,&#10;            size=24,&#10;            color=(colors.RED if colors is not None else None),&#10;            weight=ft.FontWeight.BOLD,&#10;            text_align=ft.TextAlign.CENTER&#10;        )&#10;        botao_voltar = ft.ElevatedButton(&#10;            &quot;Voltar ao início&quot;,&#10;            bgcolor=(colors.BLUE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            on_click=lambda _: self.tela_inicial()&#10;        )&#10;        self.page.add(&#10;            ft.Container(&#10;                content=ft.Column([msg, botao_voltar], alignment=ft.MainAxisAlignment.CENTER, horizontal_alignment=ft.CrossAxisAlignment.CENTER),&#10;                alignment=ft.alignment.center,&#10;                expand=True&#10;            )&#10;        )&#10;&#10;    def desistir(self, e=None):&#10;        # Sem diálogos: processa desistência imediatamente&#10;        try:&#10;            self.page.dialog = None&#10;        except Exception:&#10;            pass&#10;        try:&#10;            # limpar eventuais AlertDialogs remanescentes na overlay (compat)&#10;            ov = getattr(self.page, &quot;overlay&quot;, [])&#10;            for it in list(ov):&#10;                try:&#10;                    if getattr(it, &quot;__class__&quot;, None).__name__ == &quot;AlertDialog&quot;:&#10;                        try:&#10;                            ov.remove(it)&#10;                        except Exception:&#10;                            pass&#10;                except Exception:&#10;                    pass&#10;        except Exception:&#10;            pass&#10;&#10;        # ação de desistir (mesma lógica do &quot;Sim&quot; anterior)&#10;        try:&#10;            self.page.clean()&#10;        except Exception:&#10;            pass&#10;        msg = ft.Text(&#10;            f&quot; Você desistiu!\nSaiu com R${self.pontos}&quot;,&#10;            size=24,&#10;            color=(colors.ORANGE if colors is not None else None),&#10;            weight=ft.FontWeight.BOLD,&#10;            text_align=ft.TextAlign.CENTER&#10;        )&#10;        botao_voltar = ft.ElevatedButton(&#10;            &quot;Voltar ao início&quot;,&#10;            bgcolor=(colors.BLUE if colors is not None else None),&#10;            color=(colors.WHITE if colors is not None else None),&#10;            on_click=lambda _: self.tela_inicial()&#10;        )&#10;        self.page.add(&#10;            ft.Container(&#10;                content=ft.Column([msg, botao_voltar], alignment=ft.MainAxisAlignment.CENTER, horizontal_alignment=ft.CrossAxisAlignment.CENTER),&#10;                alignment=ft.alignment.center,&#10;                expand=True&#10;            )&#10;        )&#10;&#10;# Compatibilidade: substituir UserControl por Control&#10;if not hasattr(ft, &quot;Control&quot;):&#10;    ft.Control = ft.Container  # Fallback para versões antigas&#10;&#10;# Nova função: mostra/atualiza mensagem simples na página (sem diálogos)&#10;def _page_message(page: ft.Page, message: str, color=None):&#10;    try:&#10;        if not message:&#10;            message = &quot;&quot;&#10;        txt = getattr(page, &quot;_page_message&quot;, None)&#10;        if txt is None:&#10;            txt = ft.Text(message, color=color, size=14)&#10;            page._page_message = txt&#10;            try:&#10;                # adicionar no topo; dependendo do fluxo, page.clean() pode remover isso&#10;                page.add(txt)&#10;            except Exception:&#10;                try:&#10;                    page.controls.insert(0, txt)&#10;                except Exception:&#10;                    pass&#10;        else:&#10;            txt.value = message&#10;            if color is not None:&#10;                try:&#10;                    txt.color = color&#10;                except Exception:&#10;                    pass&#10;        try:&#10;            page.update()&#10;        except Exception:&#10;            pass&#10;    except Exception as ex:&#10;        print(&quot;Erro _page_message:&quot;, ex)&#10;&#10;# Função adicionada: show_control&#10;def show_control(page: ft.Page, control_or_factory, *args, **kwargs):&#10;    &quot;&quot;&quot;&#10;    Substitui o conteúdo da página pelo controle retornado por control_or_factory.&#10;    control_or_factory pode ser:&#10;      - uma callable que retorna uma instância (UserControl ou outro), ou&#10;      - uma instância de controle.&#10;    Retorna a instância criada (ou None em erro).&#10;    &quot;&quot;&quot;&#10;    try:&#10;        # criar ou obter a instância do controle&#10;        ctrl = control_or_factory(*args, **kwargs) if callable(control_or_factory) else control_or_factory&#10;&#10;        # Se for uma instância de ft.UserControl (ou substituto), NÃO chamar build() manualmente:&#10;        # adicionar a instância e deixar o framework gerenciar o build.&#10;        try:&#10;            is_usercontrol = isinstance(ctrl, ft.UserControl)&#10;        except Exception:&#10;            # fallback: detectar pelo nome da classe&#10;            is_usercontrol = getattr(ctrl.__class__, &quot;__name__&quot;, &quot;&quot;) == &quot;UserControl&quot;&#10;&#10;        built = None&#10;        if is_usercontrol:&#10;            built = ctrl  # adicionar a instância diretamente&#10;        else:&#10;            # se tem build(), tentar usar o resultado; senão, usar a própria instância&#10;            if hasattr(ctrl, &quot;build&quot;) and callable(getattr(ctrl, &quot;build&quot;)):&#10;                try:&#10;                    built = ctrl.build() or ctrl&#10;                except Exception:&#10;                    # se build falhar, fallback para a própria instância&#10;                    built = ctrl&#10;            else:&#10;                built = ctrl&#10;&#10;        # limpar a página (tenta várias estratégias)&#10;        try:&#10;            page.clean()&#10;        except Exception:&#10;            try:&#10;                if hasattr(page, &quot;controls&quot;):&#10;                    page.controls.clear()&#10;            except Exception:&#10;                pass&#10;&#10;        # adicionar built (pode ser lista/tupla ou um único controle)&#10;        try:&#10;            if isinstance(built, (list, tuple)):&#10;                for c in built:&#10;                    page.add(c)&#10;            else:&#10;                page.add(built)&#10;        except Exception:&#10;            try:&#10;                page.controls.append(built)&#10;            except Exception:&#10;                pass&#10;&#10;        try:&#10;            page.update()&#10;        except Exception:&#10;            pass&#10;&#10;        return ctrl&#10;    except Exception as ex:&#10;        # não quebrar a aplicação; log simples&#10;        try:&#10;            print(&quot;show_control error:&quot;, ex)&#10;        except Exception:&#10;            pass&#10;        return None&#10;&#10;class TelaEntrada(ft.Control):  # Substituir UserControl por Control&#10;    def __init__(self, page, callback):&#10;        super().__init__()&#10;        self.page = page&#10;        self.callback = callback&#10;&#10;    def build(self):&#10;        # Adicionar a logo na tela inicial&#10;        def _get_logo_src():&#10;            try:&#10;                # Verificar se o arquivo da logo existe no caminho especificado&#10;                logo_path = Path(ASSET_LOGO)&#10;                if logo_path.exists():&#10;                    # Retornar o caminho relativo para o arquivo da logo&#10;                    return ASSET_LOGO&#10;            except Exception as ex:&#10;                print(f&quot;[ERROR] Erro ao carregar a logo: {ex}&quot;)&#10;            # Fallback: retornar um texto indicando que a logo não foi encontrada&#10;            return None&#10;&#10;        logo_src = _get_logo_src()&#10;        if logo_src:&#10;            logo = ft.Image(src=logo_src, width=300, height=150, fit=ft.ImageFit.CONTAIN)&#10;        else:&#10;            logo = ft.Text(&quot;Logo não encontrada&quot;, size=16, color=colors.RED)&#10;&#10;        btn_entrar = ft.ElevatedButton(&quot;Entrar&quot;, width=300, on_click=self.entrar)&#10;        btn_registrar = ft.ElevatedButton(&quot;Registrar&quot;, width=300, on_click=self.registrar)&#10;        btn_guest = ft.TextButton(&quot;Entrar sem conta&quot;, width=300, on_click=self.entrar_sem_conta)&#10;        col = ft.Column(&#10;            [&#10;                logo,  # Adiciona a logo no topo&#10;                ft.Text(&quot;Bem-vindo&quot;, size=28, weight=ft.FontWeight.BOLD),&#10;                btn_entrar,&#10;                btn_registrar,&#10;                btn_guest&#10;            ],&#10;            alignment=ft.MainAxisAlignment.CENTER,&#10;            horizontal_alignment=ft.CrossAxisAlignment.CENTER,&#10;            spacing=12&#10;        )&#10;        # Container expandido para centralizar verticalmente&#10;        return ft.Container(content=col, alignment=ft.alignment.center, expand=True)&#10;&#10;    def entrar(self, e):&#10;        try:&#10;            show_control(self.page, lambda: TelaLogin(self.page, self.callback))&#10;            return&#10;        except Exception:&#10;            pass&#10;        try:&#10;            self.page.clean()&#10;        except Exception:&#10;            pass&#10;        try:&#10;            show_control(self.page, lambda: TelaEntrada(self.page, self.callback))&#10;            self.page.update()&#10;        except Exception:&#10;            pass&#10;&#10;    def registrar(self, e):&#10;        try:&#10;            # Garantir que TelaRegistro seja exibida corretamente&#10;            show_control(self.page, lambda: TelaRegistro(self.page, self.callback))&#10;            self.page.update()  # Forçar atualização da página&#10;        except Exception as ex:&#10;            import traceback as _tb&#10;            tb = _tb.format_exc()&#10;            print(&quot;[ERROR] Erro ao abrir TelaRegistro:&quot;, tb)  # Log para depuração&#10;            try:&#10;                _page_message(self.page, &quot;Erro ao abrir Registro. Veja console.&quot;, (colors.RED if colors is not None else None))&#10;            except Exception:&#10;                pass&#10;&#10;    # Novo: entrar como convidado (sem conta)&#10;    def entrar_sem_conta(self, e):&#10;        try:&#10;            # inicia o jogo diretamente como &quot;convidado&quot;&#10;            ShowDoMilhao(self.page, on_logout=lambda: show_control(self.page, lambda: TelaEntrada(self.page, self.callback)))&#10;            return&#10;        except Exception as ex:&#10;            try:&#10;                _page_message(self.page, &quot;Erro ao entrar como convidado&quot;, str(ex))&#10;            except Exception:&#10;                pass&#10;        # fallback: voltar à tela de entrada&#10;        try:&#10;            show_control(self.page, lambda: TelaEntrada(self.page, self.callback))&#10;        except Exception:&#10;            pass&#10;&#10;# Novas classes adicionadas: TelaLogin e TelaRegistro&#10;class TelaLogin(ft.Control):  # Substituir UserControl por Control&#10;    def __init__(self, page, callback):&#10;        super().__init__()&#10;        self.page = page&#10;        self.callback = callback&#10;        self.matricula = ft.TextField(label=&quot;Matrícula&quot;, width=320)&#10;        self.senha = ft.TextField(label=&quot;Senha&quot;, password=True, can_reveal_password=True, width=320)&#10;        self.msg = ft.Text(&quot;&quot;, size=14)  # área de mensagem inline&#10;&#10;    def build(self):&#10;        btn_ok = ft.ElevatedButton(&quot;Entrar&quot;, width=320, on_click=self.on_entrar)&#10;        btn_voltar = ft.TextButton(&quot;Voltar&quot;, on_click=self.on_voltar)&#10;        col = ft.Column(&#10;            [&#10;                ft.Text(&quot;Login&quot;, size=24, weight=ft.FontWeight.BOLD),&#10;                self.matricula,&#10;                self.senha,&#10;                btn_ok,&#10;                btn_voltar,&#10;                self.msg  # mostrar mensagens aqui&#10;            ],&#10;            alignment=ft.MainAxisAlignment.CENTER,&#10;            horizontal_alignment=ft.CrossAxisAlignment.CENTER,&#10;            spacing=12&#10;        )&#10;        return ft.Container(content=col, alignment=ft.alignment.center, expand=True)&#10;&#10;    def on_entrar(self, e):&#10;        matricula = (self.matricula.value or &quot;&quot;).strip()&#10;        senha = (self.senha.value or &quot;&quot;).strip()&#10;        if not matricula or not senha:&#10;            self.msg.value = &quot;Informe matrícula e senha.&quot;&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            return&#10;        try:&#10;            ok, resp = login_usuario(matricula, senha)&#10;        except Exception as ex:&#10;            self.msg.value = str(ex)&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            return&#10;        if ok:&#10;            try:&#10;                ShowDoMilhao(self.page, on_logout=lambda: show_control(self.page, lambda: TelaEntrada(self.page, self.callback)))&#10;                return&#10;            except Exception as ex:&#10;                self.msg.value = &quot;Erro ao iniciar jogo.&quot;&#10;                self.msg.color = (colors.RED if colors is not None else None)&#10;                try:&#10;                    self.page.update()&#10;                except Exception:&#10;                    pass&#10;        else:&#10;            # Mostrar mensagem de erro em vermelho&#10;            self.msg.value = &quot;Senha ou Matricula Incorreta!&quot;&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.senha.value = &quot;&quot;&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;&#10;    def on_voltar(self, e):&#10;        try:&#10;            show_control(self.page, lambda: TelaEntrada(self.page, self.callback))&#10;        except Exception:&#10;            try:&#10;                self.page.clean()&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.add(TelaEntrada(self.page, self.callback))&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;&#10;&#10;class TelaRegistro(ft.Control):  # Substituir UserControl por Control&#10;    def __init__(self, page, callback):&#10;        super().__init__()&#10;        self.page = page&#10;        self.callback = callback&#10;        self.nome = ft.TextField(label=&quot;Nome&quot;, width=320)&#10;        self.matricula = ft.TextField(label=&quot;Matrícula&quot;, width=320)&#10;        self.email = ft.TextField(label=&quot;Email&quot;, width=320)&#10;        self.senha = ft.TextField(label=&quot;Senha&quot;, password=True, can_reveal_password=True, width=320)&#10;        self.msg = ft.Text(&quot;&quot;, size=14)  # área de mensagem inline&#10;&#10;    def build(self):&#10;        btn_reg = ft.ElevatedButton(&quot;Registrar&quot;, width=320, on_click=self.on_registrar)&#10;        btn_voltar = ft.TextButton(&quot;Voltar&quot;, on_click=self.on_voltar)&#10;        col = ft.Column(&#10;            [&#10;                ft.Text(&quot;Registrar&quot;, size=24, weight=ft.FontWeight.BOLD),&#10;                self.nome,&#10;                self.matricula,&#10;                self.email,&#10;                self.senha,&#10;                btn_reg,&#10;                btn_voltar,&#10;                self.msg  # mostrar mensagens aqui&#10;            ],&#10;            alignment=ft.MainAxisAlignment.CENTER,&#10;            horizontal_alignment=ft.CrossAxisAlignment.CENTER,&#10;            spacing=10&#10;        )&#10;        return ft.Container(content=col, alignment=ft.alignment.center, expand=True)&#10;&#10;    def on_registrar(self, e):&#10;        nome = (self.nome.value or &quot;&quot;).strip()&#10;        matricula = (self.matricula.value or &quot;&quot;).strip()&#10;        email = (self.email.value or &quot;&quot;).strip()&#10;        senha = (self.senha.value or &quot;&quot;).strip()&#10;        try:&#10;            ok, resp = registrar_usuario(nome, matricula, email, senha)&#10;        except Exception as ex:&#10;            self.msg.value = str(ex)&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            return&#10;        if ok:&#10;            # sucesso: mostrar mensagem verde e redirecionar para login após delay curto&#10;            self.msg.value = &quot;Usuário registrado com sucesso. Redirecionando para Login...&quot;&#10;            self.msg.color = (colors.GREEN if colors is not None else None)&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;            # agendar redirecionamento breve&#10;            def _delayed():&#10;                import time&#10;                try:&#10;                    time.sleep(1.2)&#10;                except Exception:&#10;                    pass&#10;                try:&#10;                    show_control(self.page, lambda: TelaLogin(self.page, self.callback))&#10;                    self.page.update()  # Forçar atualização após redirecionamento&#10;                except Exception as ex:&#10;                    print(&quot;[ERROR] Erro ao redirecionar para TelaLogin:&quot;, ex)&#10;            try:&#10;                # executar em thread leve sem bloquear UI&#10;                import threading&#10;                threading.Thread(target=_delayed, daemon=True).start()&#10;            except Exception:&#10;                try:&#10;                    show_control(self.page, lambda: TelaLogin(self.page, self.callback))&#10;                    self.page.update()&#10;                except Exception:&#10;                    pass&#10;        else:&#10;            msg = str(resp)&#10;            self.msg.value = msg&#10;            self.msg.color = (colors.RED if colors is not None else None)&#10;            try:&#10;                self.senha.value = &quot;&quot;&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;&#10;    def on_voltar(self, e):&#10;        try:&#10;            # Voltar para a tela de entrada&#10;            show_control(self.page, lambda: TelaEntrada(self.page, self.callback))&#10;        except Exception as ex:&#10;            print(&quot;[ERROR] Erro ao voltar para TelaEntrada:&quot;, ex)&#10;            try:&#10;                self.page.clean()&#10;            except Exception:&#10;                pass&#10;            try:&#10;                self.page.add(TelaEntrada(self.page, self.callback))&#10;                self.page.update()&#10;            except Exception:&#10;                pass&#10;&#10;# Removidas funções de AlertDialog; agora usar _page_message ou mensagens nas telas.&#10;&#10;def main(page: ft.Page):&#10;    # define cor de fundo já na entrada para evitar tela cinza em formulários&#10;    try:&#10;        page.bgcolor = &quot;#002e5c&quot;&#10;    except Exception:&#10;        pass&#10;&#10;    def iniciar_jogo():&#10;        try:&#10;            page.clean()&#10;        except Exception:&#10;            pass&#10;&#10;        # função para retornar à tela de entrada (login/registro)&#10;        def show_entry():&#10;            try:&#10;                page.clean()&#10;            except Exception:&#10;                pass&#10;            try:&#10;                show_control(page, lambda: TelaEntrada(page, iniciar_jogo))&#10;            except Exception:&#10;                try:&#10;                    page.add(TelaEntrada(page, iniciar_jogo))&#10;                except Exception:&#10;                    pass&#10;&#10;        try:&#10;            # envolver toda inicialização do jogo em try/except para capturar erros&#10;            # aqui simplesmente mostramos a tela de entrada (registro/login)&#10;            show_entry()&#10;            try:&#10;                page.update()&#10;            except Exception:&#10;                pass&#10;        except Exception:&#10;            try:&#10;                import traceback as _tb&#10;                tb = _tb.format_exc()&#10;            except Exception:&#10;                tb = &quot;Erro desconhecido&quot;&#10;            try:&#10;                _page_message(page, &quot;Erro ao iniciar interface&quot;, tb)&#10;            except Exception:&#10;                pass&#10;&#10;    # inicialização padrão quando a app é aberta&#10;    try:&#10;        # mostra a tela de entrada e passa o callback iniciar_jogo (usar show_control para compat)&#10;        show_control(page, lambda: TelaEntrada(page, iniciar_jogo))&#10;        try:&#10;            page.update()&#10;        except Exception:&#10;            pass&#10;    except Exception:&#10;        try:&#10;            import traceback as _tb&#10;            tb = _tb.format_exc()&#10;        except Exception:&#10;            tb = &quot;Erro desconhecido&quot;&#10;        try:&#10;            _page_message(page, &quot;Erro na inicialização. Veja console.&quot;, (colors.RED if colors is not None else None))&#10;        except Exception:&#10;            pass&#10;&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    # Usa a porta do Railway se existir&#10;    port = os.environ.get(&quot;PORT&quot;)&#10;&#10;    if port:&#10;        #  Modo WEB (Railway ou celular)&#10;        ft.app(&#10;            target=main,&#10;            view=ft.WEB_BROWSER,&#10;            port=int(port),&#10;            host=&quot;0.0.0.0&quot;,&#10;            assets_dir=&quot;.&quot;    # ✅ preciso para logo e audio funcionarem&#10;        )&#10;    else:&#10;        #  Modo APP (rodando no PC local)&#10;        ft.app(&#10;            target=main,&#10;            view=ft.AppView,  # ✅ importante para gerar APK e rodar localmente&#10;            assets_dir=&quot;.&quot;    # ✅ necessário para carregar logo.png&#10;        )&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>